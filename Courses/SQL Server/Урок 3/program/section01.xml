<?xml version="1.0" encoding="windows-1251" ?>

<!DOCTYPE page [
<!ENTITY nbsp "&#160;">
<!ENTITY пробел "&#160;">
<!ENTITY shy "&#173;">
<!ENTITY перенос "&#173;">
]>

<?xml:stylesheet type="text/xsl" href="../common/layout.xsl" ?>

<Урок xmlns="x-schema:Schema.xml" название="SQL Server"  предыдущий="index.xml" следующий="section02.xml" copyright="© 2005 Вадим Волянский, Алексей Туманов.">

<p>
Вы уже начали рассматривать строение SQL Server, рассмотрели строение и создание баз данных и таблиц. Это просто Здорово. Вы даже начали писать запросы!!! Но. В жизни вряд ли вся информация (как в Books) храниться в одной таблице и наверняка найдены модели, которые позволяют наиболее оптимально хранить и использовать хранящиеся данные. Вот об этом и пойдет речь в этом уроке.
</p>

<h1 style="color:maroon">Аномалии взаимодействия с однотабличной базой данных.</h1>

<p>
Что из себя представляет аномалия в обычной жизни. Каждый понимает это по своему, общая же идея такова: Аномалия это то, что не является нормой и в связи с этим считается определенной странностью и исключением. Впрочем, с понятием исключений вы встречались на программировании, например, когда программа выполняет недопустимую операцию (например деление на 0) и закрывается. Это аномалия работы приложения.
</p>

<p>
При взаимодействии с однотабличной базой данных может также произойти ряд аномалий. Т.е. логически все построено, вроде бы, правильно, но возникает ошибка, которая может повлечь нарушение всей структуры базы данных.
</p>

<p>
Список аномалий, которые могут вам встретиться:
</p>

<ol>
	<li>Аномалия добавления.</li>
	<li>Аномалия обновления.</li>
	<li>Аномалия удаления.</li>
</ol>

<h3 align='center'><font color="#1925AB">Аномалия добавления.</font></h3>

<p>
Давайте внимательнее рассмотрим базу данных books. На первый взгляд все здорово и понятно. Но, изменив некоторые параметры, вы поймете, на сколько удобно с ней работать сейчас и какие варианты аномалий с ней могли бы происходить.
</p>

<p>
Допустим, что все столбцы таблицы обязательны для заполнения. Но вам поступает заказанная кем-то книга, которую необходимо занести в базу. При этом вы не знаете ни названия издательства, ни цену. Для этого требовалось бы сделать следующий запрос.
</p>

<pre style="border-color:#F38712">
Insert into books

values(772,8901,1,'Аномалии при работе с базой данных',null,null,

550,'80*20/15',2005-01-09,25000,'базы данных','аномалии')
</pre>

<p>
Ошибок в синтаксисе нет, но ошибка будет в том, что занести данные нужно во все поля и подставить null запрещено, т.к. в противном случае информация о потенциально новом издательстве может просто отсутствовать в базе данных.
</p>

<p>
И еще один пимер, понагляднее. Вот информация из базы данных Магазин, в которой храниться информация о продуктах, продавцах и поставщиках.
</p>

<img src="img\pict24.jpg"></img>

<p>
Как видите, вся эта информация хранится в одной таблице. Проблема: Товар нужно добавить, а телефон поставщика не знаем. Это поле является обязательным для заполнения и поэтому товар не может быть добавлен.
</p>

<h3 align='center'><font color="#1925AB">Аномалия обновления.</font></h3>

<p>
Еще одна аномалия. Представьте, что кроме названия издательства в базе данных еще необходимо хранить к каждому из издательств коды тех книг, которые они издали. При этом у какой-то одной книги меняется ее код. Одного запроса для этого не хватит, да и может произойти ситуация, когда в каких-то полях номер изменен не будет, что приведет к нарушению целостности всей базы данных.
</p>

<h3 align='center'><font color="#1925AB">Аномалия удаления.</font></h3>

<p>
При удалении какой-либо информации может произойти ситуация, когда будет случайно удалена нужная. Например, вы хотите из базы данных удалить издательства, а при этом удаляется несколько категорий. Т.о. мы теряем из списка категорий те, которые понадобятся для работы в дальнейшем. Или, удаляя категории, теряем тематику и т.д.
</p>

<p>
Давайте снова рассмотрим базу данных Магазин. Представте, что производится удаление из базы данных всех товаров, которые хранятся на складе больше 2 недель и еще Магазин поссорился с Хлебзаводом №3 и все записи об этом хлебзаводе также нужно удалить.
</p>

<pre>

delete from shop where date_in&lt;getdate()-14 or bringer ='Хлебзавод №3'

</pre>

<p>
Посмотрите на таблицу.
</p>

<img src="img\pict24.jpg"></img>
<p>
Такой запрос удалит все записи о Сергее Васильеве, т.е. в результате пропал сотрудник.
</p>

<p>
Получается, что при удалении одних данных мы непременно теряем те, которые удалять не стоило.
</p>

<p>
Все эти 3 аномалии говорят о том, то структура нашей существующей базы данных не является оптимальной как по мере использования, так и по мере хранения информации, т.к. одна и та же информация повторяется очень много раз, что отражается на размере базы данных.
</p>

<p>
Выход один. Нужно разбить существующую таблицу на несколько отдельных.
</p>

<p>
Т.о. мы переходим к созданию многотабличных баз данных.
</p>



</Урок>