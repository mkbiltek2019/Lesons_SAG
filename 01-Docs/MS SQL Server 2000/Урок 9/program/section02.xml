<?xml version="1.0" encoding="windows-1251" ?>

<!DOCTYPE page [
<!ENTITY nbsp "&#160;">
<!ENTITY пробел "&#160;">
<!ENTITY shy "&#173;">
<!ENTITY перенос "&#173;">
]>

<?xml:stylesheet type="text/xsl" href="../common/layout.xsl" ?>

<Урок xmlns="x-schema:Schema.xml" название="Виды резервного копирования."  предыдущий="section01.xml" следующий="section03.xml" copyright="© 2005 Вадим Волянский, Алексей Туманов.">

<h1 style="color:maroon">Виды резервного копирования.</h1>

<p>В SQL Server существует 3 вида резервного копирования, которые отличаются кол-вом требуемого места, скоростью и в том, как SQL Server будет производить восстановление данных. Вот их список:
</p>

<p>При резервном копировании необходимо производить защиту данных двумя способами:</p>

<ol>
	<li><b>Аппаратным.</b></li>
	<li><b>Программным.</b></li>
</ol>

<p><b>Аппаратный</b> способ реализуется при помощи т.н. технологии RAID (Redundant Array of Inexpensive Disks - матрица недорогих устройств с избыточностью). Технология RAID позволяет настроить хранение данных на жестких дисках так, чтобы обеспечить максимальную производительность системы и надежность хранения данных.</p>

<p>При использовании RAID выделяют 3 основных понятия:</p>

<ol>
	<li><b><i>Отображение.</i></b> 2 логических диска считаются отображенными в том случае, если они содержат одинаковые данные. При этом изменение данных на одном диске ведет к синхронизации на другом.</li>
	<li><b><i>Дублирование (Зеркалирование).</i></b> Информация синхронизируется на 2-х разных HDD.</li>
	<li><b><i>Распределенные диски.</i></b> Данные располагаются на разных дисках, при этом они разбиты на отдельные части, при этом каждая часть хранит данные, отличные от данных на других дисках.</li>
</ol>

<p>Всего разделяют 7 видов RAID:</p>

<table>
	<tr><td width="110px"><b>RAID 0</b></td><td>используется система распределенных дисков без т.н. контрольных данных. (<i><b>Контрольные данные</b> - набор значений, позволяющих восстановить пропущенные данные. При потере данных на одном диске, существует возможность восстановления по обычным и контрольным данным, хранящимся на другом диске.</i>) В такой системе должно быть не меньше 2-х HDD. При этом считается, что обеспечивается максимальная производительность.</td></tr>
	<tr><td><b>RAID 1</b></td><td>использует систему дублирования. Должно быть не меньше 2-х HDD. В документации SQL сервера утверждается, что RAID 1 можно также использовать для технологии отображения. Считается, что RAID 1 обеспечивает максимальную надежность.</td></tr>
	<tr><td><b>RAID 2, 3, 4</b></td><td>Это старые версии RAID 5, которые в настоящее время не используются.</td></tr>
	<tr><td><b>RAID 5</b></td><td>обычно используется технологи распределенных дисков с контрольными данными, которые помогают восстановить часть утерянной информации. Обычно говорят не менее чем о 3-х HDD. RAID 5 считается оптимальным в смысле соотношения надежности хранения информации и стоимостью.</td></tr>

<tr><td></td><td>
Схема распределения данных, при работе с RAID 5, может быть, как представлено на следующей схеме:</td></tr>
<tr><td></td><td>
<img src="img\pict1.jpg"></img></td></tr>

<tr><td></td><td>
Либо на этой:
</td></tr>
<tr><td></td><td>
<img src="img\pict2.jpg"></img>
</td></tr>
	<tr><td width="110px"><b>RAID 10</b></td><td>Обычно называют RAID 1+0. Это система распределенных дисков без контрольных данных. Обычно это 4 диска, которые парами дублирую друг друга.</td></tr>
<tr><td></td><td><img src="img\pict3.jpg"></img></td></tr>
</table>

<p>Существует 2 вида поддержки RAID.</p>

<ul>
	<li><b><i>Аппаратная поддержка</i></b> - реализуется при помощи специальных дополнительных устройств.</li>
	<li><b><i>Программная поддержка</i></b> - встроена в Windows 2000/NT.</li>
</ul>

<br/>

<p>Резервное копирование в SQL Server производится динамически, т.е. нет необходимости останавливать работу всех пользователей, оно производится одновременно с работой. В то же время нужно помнить, что, учитывая, что резервное копирование требует много ресурсов, лучше проводить его во время наименьшей активности сервера.</p>

<ol>
	<li><b>Полное резервное копирование.</b> При этом способе резервного копирования, копированию подлежат все таблицы, индексы, журналы транзакций все объекты базы данных и системные таблицы.</li>
	<li><b>Распределенное резервное копирование.</b> Копированию подлежат только данные, измененные с момента проведения последнего резервного копирования.</li>
	<li><b>Резервное копирование файла или группы файлов.</b> В этом случае, создаются резервные копии указанных файлов, а не всей базы данных. (Напоминаю, что при создании таблицы, либо индекса, существует возможность задать группу, в которой она будет сохраняться. Т.о. после, можно будет создавать резервную копию только указанного файла, либо группы файлов.)</li>
	<li><b>Резервное копирование журнала транзакций.</b> В журнал транзакций записываются выполненные команды пользователей. Т.о. при резервировании журнала существует возможность после выполнить тот же самый набор команд.</li>
</ol>

<h3 style="color:#05027E;text-align:center">Перед резервным копированием!!!</h3>

<p>Прежде чем производить резервное копирование, нужно ответить на набор вопросов:</p>

<ol>
	<li>Кто отвечает за сохранность базы?<p>В прошлом уроке определили, что для проведения любой операции в SQL Server необходимы права. Создавать резервную копию могут пользователя из ролей sysadmin, dw_owner, db_backupoperator.</p></li>
	<li>Необходимо ли осуществлять проверку правильности базы, а также правильность копии? <p>В SQL Server включена возможность проверки правильности базы данных и правильности копии. Это очень полезно, т.к. создавать резервную копию испорченной базы данных по меньшей мере пустая трата времени. Но нужно помнить об одной особенности. Даже если база данных "правильная", и вы это проверили до процесса резервного копирования, то это не гарантирует "правильности" резервных копий. Поэтому необходимо копии проверять также.</p></li>
	<li>Какие БД должны подвергаться резервному копированию?</li>
	<p>Рекомендации.</p>
	<ul>
		<li>Рекомендуется подвергать резервному копированию все пользовательские БД.</li>
		<li>Рекомендуется создавать копию БД master, копию БД msdb. БД model обычно сохраняют только в крайнем случае. В базе данных msdb храниться информация о проведении репликаций. Обычно, резервную копию msdb создают раз в неделю, а журнала транзакций - раз в день.</li>
		<li>БД tempdb резервному копированию подвергать не имеет большого смысла, т.к. она автоматически воссоздается при перезапуске SQL Server.</li>
		<li>При использовании средств репликации данных, необходимо создавать резервные копии этих распределенных баз данных.</li>
	</ul>
	<li>Где размещать резервную копию? <p>Сервер SQL может резервировать на жёсткий диск, ленточный носитель, либо на сетевом диске (через именованный канал).
Наиболее часто используются дисковые файлы (локальные или сетевые) для хранения резервных копий. Когда вы резервируете на ленточный носитель, он должен быть локально подключён к компьютеру. </p></li>
	<li>Как часто выполнять резервное копирование?<p>Все зависит от особенностей
вашего производственного окружения и от размера базы данных. При размере базы данных в 2 Гб рекомендуется производить резервное копирование один раз в день, а создавать резервную копию журнала транзакций - несколько раз в день.</p></li>
	<li>Как долго копия является актуальной?<p>Резервная копия должна храниться в надежном месте до тех пор, пока не будет создана новая, проверенная на "правильность" резервная копия. Надежное место может быть, например, сейф.</p></li>
</ol>

</Урок>